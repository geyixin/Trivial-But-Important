# 输入URL之后发生了什么？

> 1.根据输入的URL的向DNS服务器查询对应的IP地址
>
> 2.拿到IP地址，浏览器向web服务器发送HTTP请求，建立TCP连接
>
> 3.返回HTTP请求
>
> 4.浏览器获取请求页面的html并显示
>
> 5.窗口关闭，终止链接

### 1.根据输入的URL的向DNS服务器查询对应的IP地址（DNS域名解析流程）

>1.1. 输入URL，按下enter键，首先需要找到IP，也就是解析域名。浏览器会首先查看本地硬盘的 host 文件，如果有的话就直接使用 host 文件里面的 ip 地址，没有则执行1.2；
>
>1.2. 浏览器向本地DNS服务器会发出一个 DNS请求。首先，本地DNS服务器会查询它的缓存记录，如果缓存中有此条记录，则直接返回结果，没有，则执行1.3。本地DNS服务器：移动、联通等。
>
>1.3.本地DNS服务器向DNS根服务器进行查询。根DNS服务器没有记录具体的域名和IP地址的对应关系，而是告诉本地DNS服务器，你可以到域服务器上去继续查询，并给出域服务器的地址。
>
>1.4.本地DNS服务器继续向域服务器发出请求，假如说请求的对象是.com域服务器，那 .com域服务器收到请求之后，也不会直接返回域名和IP地址的对应关系，而是告诉本地DNS服务器，你的域名的解析服务器的地址。
>
>1.5.最后，本地DNS服务器向域名的解析服务器发出请求，这时就能收到一个域名和IP地址对应关系，本地DNS服务器不仅要把IP地址返回给用户电脑，还要把这个对应关系保存在缓存中，以备下次别的用户查询时，可以直接返回结果，加快网络访问。
>
>补充：
>
>1.DNS：Domain Name System，域名系统，因特网上作为域名和IP地址相互映射的一个分布式数据库，能够使用户更方便的访问互联网，而不用去记住能够被机器直接读取的IP数串。
>
>2.域名解析（或主机名解析）：通过主机名得到该主机名对应的IP地址的过程。

### 2.拿到IP地址，建立TCP连接，发送HTTP请求

> 2.1.拿到域名对应的IP地址之后，浏览器会以一个随机端口（1024<端口<65535）向服务器的web 80端口发起TCP的连接请求`。`这个连接请求到达服务器端后（这中间通过各种路由设备，局域网内除外），进入到网卡，然后是进入到内核的TCP/IP协议栈（用于识别该连接请求，解封包，一层一层的剥开），还有可能要经过Netfilter防火墙（属于内核的模块）的过滤，最终到达WEB程序，最终建立了TCP/IP的连接。
>
> 2.2.建立了TCP连接之后，发起一个http请求。一个典型的 http request header 一般需要包括请求的方法，例如 GET 或者 POST 等，不常用的还有 PUT 和 DELETE 、HEAD、OPTION以及 TRACE 方法，一般的浏览器只能发起 GET 或者 POST 请求。请求信息包含三个部分：请求方法URI协议/版本、请求头(Request Header)、 请求正文。
>
> 补充：
>
> 1.事实上，在进入服务器之前，可能还会先经过负责负载均衡的机器（将请求合理地分配到多个服务器上），比如LVS，反向代理等。在经过了负载均衡后，请求真正地到了服务器的Web Server（比如 Apache，Node.JS等）。请求从链路层到应用层，此时，服务器才算真正接收到了客户端发来的HTTP请求。
>
> 2.GET和POST的区别：GET用于获取资源，POST用于修改资源（本质区别）；GET请求的数据在URL里，也就是请求行中，POST请求的数据在报文主体中；GET请求的数据明文出现，不安全；GET请求的数据会受URL长度的限制（不是HTTP对其的限制，多是浏览器的限制），POST的数据理论上不受限制，但Web Server会对提交的数据大小进行限制；GET是安全且[幂等](https://baike.baidu.com/item/%E5%B9%82%E7%AD%89/8600688?fr=aladdin)（安全：不会修改资源，幂等：多次输入同一URL，得到的结果都是一样的），POST既不安全，也不幂等。

